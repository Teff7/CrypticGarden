/* Base */
:root{
  --bg:#000; --fg:#fff; --tooltip-bg:#fff; --tooltip-fg:#000; --cell:44px;
  --tip-col-1:#fff2a8;
  --tip-col-2:#b9f4c8;
  --tip-col-3:#b4e1ff;
  --tip-col-4:#fbc4ff;
  --tip-col-5:#ffe0b5;
  --tip-col-6:#d6c4ff;
  --definition-highlight:#ffb6e3;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--fg);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
}

.visually-hidden{
  position:absolute;
  width:1px;
  height:1px;
  padding:0;
  margin:-1px;
  overflow:hidden;
  clip:rect(0,0,0,0);
  white-space:nowrap;
  border:0;
}

/* Ensure the HTML [hidden] attribute actually hides sections */
[hidden]{ display:none !important; }

/* Screens */
.welcome-screen,.game-screen{
  min-height:100vh;
  display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  gap:1rem; text-align:center;
}
.brand{font-weight:800; letter-spacing:.02em}

/* Roadmap (unchanged) */
.roadmap{display:flex; gap:1rem; margin:1rem 0;}
.road-item{
  width:56px; height:56px; border:2px solid var(--fg); border-radius:14px;
  display:grid; place-items:center; position:relative;
}
.icon{width:28px; height:28px; fill:var(--fg)}
.road-item::after{
  content:attr(data-tip); position:absolute; left:50%; transform:translate(-50%,calc(-100% - 10px));
  background:var(--tooltip-bg); color:var(--tooltip-fg);
  padding:.4rem .6rem; border-radius:8px; white-space:nowrap;
  opacity:0; pointer-events:none; transition:opacity .15s; font-size:.9rem;
}
.road-item:hover::after{opacity:1}

/* Buttons */
.play-button,.help-button{
  border:2px solid var(--fg); background:transparent; color:var(--fg);
  padding:.55rem 1rem; border-radius:12px; font-weight:600; cursor:pointer;
}
.help-button.small{padding:.35rem .6rem; font-size:.9rem}

/* TOP: centre date + menu as a group */
.top-bar{ width:min(560px, 92vw); display:flex; justify-content:center; }
.top-center{ display:flex; align-items:center; justify-content:center; gap:.6rem; flex-wrap:wrap; }
.puzzle-select{
  border:2px solid var(--fg);
  background:transparent;
  color:var(--fg);
  padding:.35rem .75rem;
  border-radius:12px;
  font-weight:600;
  font-size:.95rem;
}
.puzzle-select:disabled{ opacity:.6; }
.puzzle-select option{ color:#000; }
.date{ font-size:.95rem; opacity:.8; display:none; }

/* Dropdowns */
.dropdown{position:relative}
.dropdown .menu{
  position:absolute; top:calc(100% + 8px); left:50%; transform:translateX(-50%);
  background:#111; border:1px solid #444; border-radius:12px; padding:.3rem; display:none; min-width:200px; z-index:10; text-align:center;
}
.dropdown.open .menu{display:block}
.menu-item{
  width:100%; background:transparent; color:var(--fg);
  border:1px solid #444; text-align:center; padding:.5rem .6rem; border-radius:8px; cursor:pointer; margin:.25rem 0;
}
.menu-item:hover{background:#1e1e1e}

/* Grid */
.grid{
  display:grid; grid-template-columns:repeat(5, var(--cell)); grid-template-rows:repeat(5, var(--cell));
  gap:4px; margin-top:.5rem;
}
.cell{ 
  width:var(--cell); height:var(--cell);
  display:grid; place-items:center;
  background:#fff; color:#000; border:2px solid #fff;
  position:relative; font-size:1.2rem; font-weight:700; user-select:none;
}
.cell.block{ background:#000; border-color:#000; color:#000; }
.cell.block.flowered{ display:flex; align-items:center; justify-content:center; }
.flower-icon{
  width:90%;
  height:90%;
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:none;
  animation:flower-pop .15s ease-out;
}
.flower-icon svg{ width:100%; height:100%; display:block; }
@keyframes flower-pop{
  from{ transform:scale(0.8); opacity:0; }
  to{ transform:scale(1); opacity:1; }
}
.cell .num{ position:absolute; top:2px; left:4px; font-size:.65rem; color:#000; font-weight:700; z-index:1; }
.cell .letter{ position:relative; z-index:1; }
.cell.active{ animation:flash 1s infinite alternate; outline:2px solid #fff; }
.cell.tooltip-highlight{ z-index:1; }
.cell.tooltip-highlight::after{
  content:"";
  position:absolute;
  inset:-3px;
  border-radius:10px;
  background:rgba(255, 237, 134, .55);
  animation:tooltip-pulse .6s ease-in-out infinite alternate;
  pointer-events:none;
  z-index:0;
}
.cell.tooltip-highlight.active{ outline:2px solid #fff; }
@keyframes tooltip-pulse{
  from{ opacity:.35; }
  to{ opacity:.9; }
}
@keyframes flash { 0%{background:#fff;color:#000} 100%{background:#000;color:#fff} }

/* Clue panel */
.clue-section{
  width:min(560px, 92vw);
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:.75rem;
}
.clue-panel{ width:100%; }
.clue-header{ opacity:.9; margin-top:1rem; }
.clue{ font-size:1.1rem; margin:.5rem auto 0; position:relative; }

/* Enumeration styling */
.clue .enumeration{
  opacity:.8; font-size:.9rem; font-style:italic;
}
.clue .indicator,.clue .fodder,.clue .def{ position:relative }
.clue.annot-on .indicator{ color:#9ad; }
.clue.annot-on .fodder{ color:#f47; }
.clue.help-on .def{
  background:var(--definition-highlight);
  color:#000;
  font-weight:600;
  border-radius:4px;
  padding:0 .25em;
}
.clue.help-on.annot-on .def.has-tip{
  box-shadow:0 0 0 1px rgba(0,0,0,.05) inset;
}
.clue.annot-on .has-tip{
  padding:0 .2em;
  border-radius:4px;
  color:#000;
  font-weight:600;
}
.clue.annot-on .tip-1{ background:var(--tip-col-1); }
.clue.annot-on .tip-2{ background:var(--tip-col-2); }
.clue.annot-on .tip-3{ background:var(--tip-col-3); }
.clue.annot-on .tip-4{ background:var(--tip-col-4); }
.clue.annot-on .tip-5{ background:var(--tip-col-5); }
.clue.annot-on .tip-6{ background:var(--tip-col-6); }

/* Tooltips — rendered dynamically so they can stay within the viewport */
.clue-tooltip{
  position:fixed;
  background:var(--tooltip-bg);
  color:var(--tooltip-fg);
  padding:.35rem .5rem;
  border-radius:6px;
  font-size:.95rem;
  line-height:1.2;
  box-shadow:0 2px 6px rgba(0,0,0,.3);
  z-index:100;
  pointer-events:none;
  word-wrap:break-word;
  max-width:320px;
}

@media (max-width: 600px){
  .clue.annot-on .indicator:hover::after,
  .clue.annot-on .fodder:hover::after,
  .clue.annot-on .def:hover::after{
    max-width:calc(100vw - 32px);
  }
}

/* Device colouring (first indicator) */
.clue.acrostic  { --indicator-col:#6fa8dc; }
.clue.hidden    { --indicator-col:#4caf50; }
.clue.container { --indicator-col:#b97aeb; }
.clue.reversal  { --indicator-col:#20b2aa; }
.clue.deletion  { --indicator-col:#ffca28; }
.clue.homophone { --indicator-col:#e91e63; }
.clue.anagram   { --indicator-col:#6fa8dc; }
.clue.charade   { --indicator-col:#8d6e63; }
.clue.double    { --indicator-col:#9e9e9e; }
.clue.lit       { --indicator-col:#c0c0c0; }

/* Bottom actions — centred under the clue */
.bottom-actions{
  width:100%;
  display:flex; flex-wrap:wrap; align-items:center; justify-content:center; gap:.5rem;
  margin:1rem auto 1.25rem;
}

.mobile-keyboard{ display:none; }

.mobile-keyboard-row{ display:flex; justify-content:center; gap:.35rem; }
.mobile-keyboard button{
  flex:1;
  border:0;
  border-radius:10px;
  padding:.75rem 0;
  font-size:1.05rem;
  font-weight:600;
  background:#1a1a1a;
  color:#fff;
  box-shadow:0 2px 6px rgba(0,0,0,.3);
}
.mobile-keyboard button:active{ transform:scale(.97); }
.mobile-keyboard-row.controls button{
  flex:0;
  padding:.65rem 1.1rem;
  font-size:.95rem;
}

.mobile-keyboard button.close-keyboard{ background:#333; }
.mobile-keyboard button.action-key{ background:#444; }
.mobile-keyboard button.delete-key{ background:#b53; }

@media (hover:hover){
  .mobile-keyboard button:hover{ background:#2c2c2c; }
}

body.mobile-touch{
  --mobile-keyboard-space:0px;
}
body.mobile-touch .game-screen{
  align-items:stretch;
  justify-content:flex-start;
  padding:1.5rem 1rem calc(1.5rem + var(--mobile-keyboard-space, 0px) + env(safe-area-inset-bottom, 0px));
  gap:1.25rem;
}
body.mobile-touch .top-bar,
body.mobile-touch .clue-section{
  width:100%;
  max-width:560px;
  margin:0 auto;
}
body.mobile-touch #grid{
  order:3;
  margin:0 auto;
}
body.mobile-touch .clue-section{
  order:2;
  gap:.5rem;
}
body.mobile-touch .mobile-keyboard{
  order:4;
  display:none;
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:0;
  width:100%;
  max-width:560px;
  background:#0d0d0d;
  border-radius:18px 18px 0 0;
  border:1px solid #222;
  border-bottom:none;
  box-shadow:0 -12px 32px rgba(0,0,0,.55);
  padding:1rem .65rem calc(1rem + env(safe-area-inset-bottom, 0px));
  z-index:50;
}
body.mobile-touch .mobile-keyboard.visible{ display:block; }
body.mobile-touch .clue-header{ margin-top:.35rem; }
body.mobile-touch .bottom-actions{ margin:0; }
body.mobile-touch .dropdown .menu{ transform:translate(-50%, 0); }
body.mobile-touch .grid{ margin-top:0; }
body.mobile-touch .top-bar{ order:1; }

body.mobile-touch.mobile-keyboard-open{
  --mobile-keyboard-space:var(--mobile-keyboard-height, 0px);
}

/* Modal & fireworks */
.game-screen{ position:relative; z-index:0; }

.modal{
  position:fixed; inset:0; display:grid; place-items:center; background:rgba(0,0,0,.6);
  z-index:100;
}
.modal[hidden]{ display:none }
.modal-card{
  width:min(680px, 92vw); max-height:86vh; overflow:auto;
  background:#111; border:1px solid #444; border-radius:16px; padding:1rem 1.25rem;
  display:block;
  position:relative; z-index:1;
}
#shareModal{ z-index:120; }
#shareModal .modal-card{
  display:flex;
  flex-direction:column;
  align-items:stretch;
  text-align:left;
  gap:1rem;
}

#shareHeading,
#shareSubheading{
  align-self:center;
  text-align:center;
}

#shareHeading{
  margin:0;
}

.results-translation{
  margin:-0.5rem 0 0;
  font-style:italic;
  color:#d8d8d8;
}

.results-lede{
  margin:0;
  color:#f0f0f0;
}

.results-body{
  display:flex;
  flex-direction:column;
  gap:0.75rem;
  width:100%;
}

.result-entry{
  display:flex;
  align-items:flex-start;
  gap:0.5rem;
  line-height:1.55;
}

.result-entry[role="listitem"]{
  list-style:none;
}

.result-label{
  font-weight:600;
  text-transform:uppercase;
  min-width:2.5rem;
}

.result-answer{
  font-weight:700;
  white-space:nowrap;
}

.result-comment{
  flex:1;
}

.share-preview{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:1rem;
  margin:0 auto 0.75rem;
  flex-wrap:wrap;
}

.share-grid{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  grid-auto-rows:1fr;
  gap:2px;
  width:min(80vw,250px);
  aspect-ratio:1;
  place-content:center;
}

.share-flower{
  width:56px;
  height:56px;
  background:#000;
  border-radius:10px;
  display:none;
  align-items:center;
  justify-content:center;
  padding:4px;
}

.share-flower.has-flower{
  display:flex;
}

.share-cell{
  width:100%;
  aspect-ratio:1;
}

.share-actions{
  display:flex;
  flex-wrap:wrap;
  gap:0.5rem;
  justify-content:center;
}
.help-body{
  width:100%;
  margin-top:1rem;
  text-align:left;
  line-height:1.55;
  white-space:pre-line;
}
.modal-close{
  position:sticky; top:0;
  margin-left:auto;
  display:block;
  border:0; background:transparent; color:#fff; font-size:2rem; cursor:pointer;
}
.fireworks{ position:fixed; inset:0; pointer-events:none; z-index:90; }
.pixel{ position:absolute; width:2px; height:2px; background:#fff }

/* Share modal preview grid */


/* Copy toast */
.toast{
  position:fixed; left:50%; bottom:1rem; transform:translateX(-50%);
  background:#333; color:#fff;
  padding:.4rem .8rem; border-radius:8px; font-size:.9rem;
}
.toast.hint-toast{
  bottom:3.5rem;
  background:#1f6feb;
  color:#fff;
  text-align:center;
  max-width:min(320px, 90vw);
  line-height:1.35;
  box-shadow:0 4px 10px rgba(0,0,0,.35);
}

.toast.hint-toast.mobile-grid-overlay{
  z-index:60;
  pointer-events:auto;
}
